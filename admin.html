<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Admin Autom√°tico - GitHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #050505; color: white; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #111; padding: 30px; border-radius: 16px; border: 1px solid #333; }
        
        .auto-box { background: rgba(34, 197, 94, 0.1); border: 2px solid #22c55e; padding: 20px; border-radius: 12px; margin-bottom: 30px; }
        .auto-box h3 { color: #22c55e; margin: 0 0 10px 0; font-size: 1rem; }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #161616; padding: 20px; border-radius: 12px; }
        .full { grid-column: span 2; }
        
        label { font-size: 0.75rem; color: #888; font-weight: 700; text-transform: uppercase; display: block; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 14px; background: #000; border: 1px solid #333; color: white; border-radius: 8px; outline: none; font-size: 1rem; box-sizing: border-box; }
        input:focus { border-color: #22c55e; }

        #previewContainer { margin-top: 10px; display: none; text-align: center; }
        #previewImg { width: 200px; border-radius: 8px; border: 2px solid #333; }

        .btn { padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 8px; border: none; transition: 0.3s; margin-top: 10px; }
        .btn-add { background: #333; color: #fff; border: 1px solid #555; }
        .btn-add:hover { background: #444; }
        
        /* Bot√£o Gravar GitHub */
        .btn-save { background: #22c55e; color: #000; font-size: 1.2rem; margin-top: 30px; box-shadow: 0 0 15px rgba(34,197,94,0.4); }
        .btn-save:hover { background: #16a34a; }
        .btn-save:disabled { background: #333; color: #555; cursor: not-allowed; box-shadow: none; }

        /* Lista */
        .item { background: #161616; padding: 15px; border-radius: 10px; border: 1px solid #222; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .item-info { display: flex; align-items: center; gap: 15px; }
        .item-thumb { width: 60px; height: 40px; object-fit: cover; border-radius: 4px; }
        
        .actions { display: flex; gap: 5px; }
        .actions button { width: 32px; height: 32px; border: none; border-radius: 6px; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; }
        .btn-move { background: #333; }
        .btn-edit { background: #eab308; color: black; }
        .btn-del { background: #ef4444; color: white; }

        #status { text-align: center; margin-top: 15px; font-weight: bold; min-height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="auto-box">
        <h3><i class="fas fa-robot"></i> ADMIN AUTOM√ÅTICO</h3>
        <p style="font-size: 0.9rem; margin:0;">1. Cola o link. 2. Adiciona √† lista. 3. Grava no GitHub.</p>
    </div>

    <div class="form-grid">
        <div class="full">
            <label style="color: #22c55e;">LINK DO YOUTUBE</label>
            <input type="text" id="mainLink" placeholder="Cola aqui..." oninput="autoFill()">
        </div>

        <div id="previewContainer" class="full">
            <img id="previewImg" src="">
        </div>

        <div>
            <label>Sec√ß√£o</label>
            <select id="section">
                <option value="SOFTWARE">Software Lab</option>
                <option value="MARKETING">Marketing Toolkit</option>
                <option value="INSPIRATION">Mindset & Cultura</option>
            </select>
        </div>
        <div>
            <label>Programa (ex: ps, cv)</label>
            <input type="text" id="program" placeholder="ps">
        </div>
        <div class="full">
            <label>T√≠tulo</label>
            <input type="text" id="title">
        </div>
        <div class="full">
            <label>Descri√ß√£o</label>
            <input type="text" id="desc" value="Tutorial r√°pido.">
        </div>
        
        <input type="hidden" id="finalID">
        <input type="hidden" id="thumbURL">

        <button class="btn btn-add" onclick="adicionarLocal()">‚¨á ADICIONAR √Ä LISTA ABAIXO</button>
    </div>

    <div id="status">A carregar dados do GitHub...</div>
    <div id="list" style="margin-top: 20px;"></div>

    <button id="btnGravar" class="btn btn-save" onclick="gravarNoGithub()" disabled>
        <i class="fas fa-cloud-upload-alt"></i> GRAVAR NO GITHUB
    </button>
</div>

<script>
    // --- ‚ö†Ô∏è CONFIGURA√á√ÉO OBRIGAT√ìRIA ‚ö†Ô∏è ---
    const TOKEN = 'tutorialData'; // <--- COLA O TEU TOKEN DENTRO DAS ASPAS
    const USER = 'aqueleeloi';
    const REPO = 'tutoriais';
    const FILE = 'videos.js';
    // ----------------------------------------

    let tutorialData = []; // Esta vari√°vel vai guardar os dados
    let shaAtual = "";     // Necess√°rio para o GitHub aceitar a grava√ß√£o

    // 1. CARREGAR DADOS DO GITHUB AO INICIAR
    async function carregarDoGithub() {
        const status = document.getElementById('status');
        try {
            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE}`, {
                headers: { 'Authorization': `token ${TOKEN}` }
            });
            const data = await res.json();
            shaAtual = data.sha;

            // Descodificar o conte√∫do (Base64 -> Texto -> UTF8)
            const decoder = new TextDecoder('utf-8');
            const rawContent = Uint8Array.from(atob(data.content), c => c.charCodeAt(0));
            const textContent = decoder.decode(rawContent);

            // Limpar "const tutorialData =" para obter apenas o JSON
            const jsonStr = textContent.replace('const tutorialData =', '').replace(/;\s*$/, '').trim();
            
            tutorialData = JSON.parse(jsonStr);
            renderizarLista();
            
            status.innerHTML = `<span style="color:#22c55e">‚úÖ ${tutorialData.length} v√≠deos carregados do GitHub!</span>`;
            document.getElementById('btnGravar').disabled = false;

        } catch (erro) {
            console.error(erro);
            status.innerHTML = `<span style="color:#ef4444">‚ùå Erro ao ler GitHub. Verifica o Token!</span>`;
        }
    }

    // 2. FUN√á√ÉO M√ÅGICA: PREENCHE OS DADOS SOZINHO
    function autoFill() {
        const url = document.getElementById('mainLink').value;
        let videoId = "";
        if (url.includes("v=")) videoId = url.split("v=")[1].split("&")[0];
        else if (url.includes("youtu.be/")) videoId = url.split("youtu.be/")[1].split("?")[0];

        if (videoId) {
            document.getElementById('finalID').value = videoId;
            const thumb = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
            document.getElementById('thumbURL').value = thumb;
            document.getElementById('previewImg').src = thumb;
            document.getElementById('previewContainer').style.display = "block";
            
            // Tenta adivinhar categoria
            const lowUrl = url.toLowerCase();
            if (lowUrl.includes("canva")) document.getElementById('program').value = "cv";
            else if (lowUrl.includes("photoshop")) document.getElementById('program').value = "ps";
            
            document.getElementById('title').value = "Novo V√≠deo (Edita-me)";
        }
    }

    // 3. GERIR LISTA LOCAL
    function adicionarLocal() {
        const novo = {
            section: document.getElementById('section').value,
            program: document.getElementById('program').value,
            type: "video",
            tag: "NOVO",
            title: document.getElementById('title').value,
            desc: document.getElementById('desc').value,
            id: document.getElementById('finalID').value,
            thumb: document.getElementById('thumbURL').value
        };

        if(!novo.id) return alert("Link inv√°lido!");
        
        tutorialData.push(novo); // Adiciona ao fim
        renderizarLista();
        limparForm();
        window.scrollTo(0, document.body.scrollHeight); // Vai para o fundo ver o novo item
    }

    function renderizarLista() {
        const lista = document.getElementById('list');
        lista.innerHTML = "";
        
        tutorialData.forEach((item, index) => {
            lista.innerHTML += `
                <div class="item">
                    <div class="item-info">
                        <img src="${item.thumb}" class="item-thumb">
                        <div>
                            <div style="font-weight:bold; font-size:0.9rem">${item.title}</div>
                            <div style="font-size:0.7rem; color:#666">${item.section} | ${item.program}</div>
                        </div>
                    </div>
                    <div class="actions">
                        <button class="btn-move" onclick="mover(${index}, -1)">‚ñ≤</button>
                        <button class="btn-move" onclick="mover(${index}, 1)">‚ñº</button>
                        <button class="btn-del" onclick="apagar(${index})"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        });
    }

    function apagar(i) {
        if(confirm("Apagar este v√≠deo?")) {
            tutorialData.splice(i, 1);
            renderizarLista();
        }
    }

    function mover(i, dir) {
        const novoIndex = i + dir;
        if (novoIndex >= 0 && novoIndex < tutorialData.length) {
            [tutorialData[i], tutorialData[novoIndex]] = [tutorialData[novoIndex], tutorialData[i]];
            renderizarLista();
        }
    }

    function limparForm() {
        document.getElementById('mainLink').value = "";
        document.getElementById('previewContainer').style.display = "none";
        document.getElementById('title').value = "";
    }

    // 4. GRAVAR NO GITHUB (O PASSO FINAL)
    async function gravarNoGithub() {
        const btn = document.getElementById('btnGravar');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> A GRAVAR...';
        
        // Preparar o conte√∫do no formato JS correto
        const novoConteudo = `const tutorialData = ${JSON.stringify(tutorialData, null, 2)};`;
        
        // Codificar para Base64 (com suporte a acentos)
        const conteudoBase64 = btoa(unescape(encodeURIComponent(novoConteudo)));

        try {
            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: "Atualiza√ß√£o via Admin Autom√°tico ü§ñ",
                    content: conteudoBase64,
                    sha: shaAtual
                })
            });

            if(res.ok) {
                const data = await res.json();
                shaAtual = data.content.sha;
                status.innerHTML = '<span style="color:#22c55e; font-size:1.2rem">üéâ SUCESSO! Site atualizado.</span>';
                btn.innerHTML = '<i class="fas fa-check"></i> GUARDADO';
            } else {
                throw new Error("Falha no GitHub");
            }
        } catch (e) {
            alert("Erro ao gravar. Verifica o Token.");
            btn.innerHTML = "TENTAR OUTRA VEZ";
        } finally {
            setTimeout(() => { btn.disabled = false; if(btn.innerText !== 'TENTAR OUTRA VEZ') btn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> GRAVAR NO GITHUB'; }, 3000);
        }
    }

    // Iniciar
    carregarDoGithub();

</script>
</body>
</html>
