<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Admin - Gestão de Aulas</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; padding: 30px; }
        .container { max-width: 900px; margin: 0 auto; background: #1e293b; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        
        h2 { text-align: center; color: #38bdf8; margin-bottom: 25px; }
        
        /* Formulário */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .full { grid-column: span 2; }
        
        label { display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9rem; }
        input, select { width: 100%; padding: 12px; background: #334155; border: 1px solid #475569; color: white; border-radius: 6px; outline: none; }
        input:focus { border-color: #38bdf8; }
        
        .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        .add-btn { background: #22c55e; color: white; grid-column: span 2; font-size: 1.1rem; }
        .add-btn:hover { background: #16a34a; }
        
        /* Lista */
        .list-header { margin-top: 40px; padding-bottom: 10px; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; }
        .list-items { margin-top: 10px; }
        
        .item { background: #0f172a; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; border-left: 4px solid #334155; }
        .item.ps { border-left-color: #0ea5e9; }
        .item.pp { border-left-color: #10b981; }

        .info strong { display: block; font-size: 1rem; }
        .info small { color: #94a3b8; font-size: 0.85rem; }
        .badge { background: #334155; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; margin-right: 5px; }
        
        .actions button { width: 35px; height: 35px; border: none; border-radius: 5px; margin-left: 5px; cursor: pointer; color: white; transition: 0.2s; }
        .move { background: #475569; } .move:hover { background: #64748b; }
        .edit { background: #f59e0b; } .edit:hover { background: #d97706; }
        .del { background: #ef4444; } .del:hover { background: #dc2626; }

        .download-bar { margin-top: 30px; background: #334155; padding: 20px; border-radius: 8px; text-align: center; }
        .dl-btn { background: #38bdf8; color: #0f172a; font-size: 1.1rem; padding: 15px 30px; }
        .dl-btn:hover { background: #0ea5e9; color: white; }

    </style>
</head>
<body>

<div class="container">
    <h2><i class="fas fa-cog"></i> Gestor de Conteúdos</h2>
    
    <input type="hidden" id="editIndex">

    <div class="form-row">
        <div>
            <label>Plataforma</label>
            <select id="platform">
                <option value="ps">Photoshop (Azul)</option>
                <option value="pp">Photopea (Verde)</option>
            </select>
        </div>
        <div>
            <label>Tipo de Conteúdo</label>
            <select id="type">
                <option value="video">Vídeo (YouTube)</option>
                <option value="doc">Documento / Link / Download</option>
            </select>
        </div>
        
        <div class="full">
            <label>Link / URL</label>
            <input type="text" id="url" placeholder="Cola aqui o link completo...">
        </div>
        
        <div class="full">
            <label>Título</label>
            <input type="text" id="title" placeholder="Ex: Manual de Atalhos">
        </div>
        
        <div class="full">
            <label>Descrição</label>
            <input type="text" id="desc" placeholder="Ex: PDF oficial para imprimir...">
        </div>
        
        <div class="full">
            <label>Categoria</label>
            <select id="tag">
                <option value="CRIACAO">Criação & Config</option>
                <option value="FERRAMENTAS">Ferramentas</option>
                <option value="RECORTE">Recorte</option>
                <option value="MASCARAS">Máscaras</option>
                <option value="EXTRA">Extra (Teoria)</option>
                <option value="DOCS">Documentos Oficiais</option>
                <option value="RECURSOS">Recursos (Imagens/Fontes)</option>
            </select>
        </div>

        <button class="btn add-btn" id="saveBtn" onclick="saveItem()">Adicionar Conteúdo</button>
        <button class="btn" id="cancelBtn" onclick="resetForm()" style="background:#475569; display:none; grid-column:span 2">Cancelar Edição</button>
    </div>

    <div class="list-header">
        <h3>Itens na Lista (<span id="count">0</span>)</h3>
    </div>
    <div id="list" class="list-items"></div>

    <div class="download-bar">
        <button class="btn dl-btn" onclick="downloadFile()"><i class="fas fa-save"></i> SALVAR ALTERAÇÕES (Baixar videos.js)</button>
        <p style="margin-top:10px; color:#94a3b8; font-size:0.9rem">Depois de baixar, substitui o ficheiro na pasta do site.</p>
    </div>
</div>

<script src="videos.js"></script>
<script>
    let data = (typeof tutorialData !== 'undefined') ? tutorialData : [];

    function render() {
        const list = document.getElementById('list');
        list.innerHTML = '';
        document.getElementById('count').innerText = data.length;

        data.forEach((item, i) => {
            let icon = item.type === 'video' ? '<i class="fab fa-youtube"></i>' : '<i class="fas fa-file-alt"></i>';
            list.innerHTML += `
                <div class="item ${item.platform}">
                    <div class="info">
                        <strong>${icon} ${item.title} <span class="badge">${item.tag}</span></strong>
                        <small>${item.desc}</small>
                    </div>
                    <div class="actions">
                        <button class="move" onclick="move(${i}, -1)" title="Subir"><i class="fas fa-arrow-up"></i></button>
                        <button class="move" onclick="move(${i}, 1)" title="Descer"><i class="fas fa-arrow-down"></i></button>
                        <button class="edit" onclick="edit(${i})" title="Editar"><i class="fas fa-pen"></i></button>
                        <button class="del" onclick="del(${i})" title="Apagar"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        });
    }

    function saveItem() {
        const url = document.getElementById('url').value;
        const title = document.getElementById('title').value;
        const type = document.getElementById('type').value;
        
        if(!url || !title) { alert("Preenche Link e Título!"); return; }

        let finalId = url;
        // Se for vídeo, tenta extrair ID
        if(type === 'video') {
            const match = url.match(/(?:v=|\/)([\w-]{11})/);
            if(match) finalId = match[1]; 
            // Se não achar ID, usa o link na mesma (fallback)
        }

        const obj = {
            id: finalId,
            title: title,
            desc: document.getElementById('desc').value,
            platform: document.getElementById('platform').value,
            type: type,
            tag: document.getElementById('tag').value
        };

        const idx = document.getElementById('editIndex').value;
        if(idx === "") data.push(obj);
        else data[idx] = obj;

        resetForm();
        render();
    }

    function edit(i) {
        const item = data[i];
        document.getElementById('editIndex').value = i;
        document.getElementById('platform').value = item.platform;
        document.getElementById('type').value = item.type;
        
        // Mostrar URL completo para editar
        let showUrl = item.id;
        if(item.type === 'video' && item.id.length === 11) showUrl = `https://www.youtube.com/watch?v=${item.id}`;
        document.getElementById('url').value = showUrl;
        
        document.getElementById('title').value = item.title;
        document.getElementById('desc').value = item.desc;
        document.getElementById('tag').value = item.tag;

        document.getElementById('saveBtn').innerText = "Atualizar Item";
        document.getElementById('cancelBtn').style.display = "block";
        window.scrollTo(0,0);
    }

    function resetForm() {
        document.getElementById('editIndex').value = "";
        document.getElementById('url').value = "";
        document.getElementById('title').value = "";
        document.getElementById('desc').value = "";
        document.getElementById('saveBtn').innerText = "Adicionar Conteúdo";
        document.getElementById('cancelBtn').style.display = "none";
    }

    function del(i) {
        if(confirm("Apagar?")) { data.splice(i, 1); render(); }
    }

    function move(i, dir) {
        const newPos = i + dir;
        if(newPos >= 0 && newPos < data.length) {
            [data[i], data[newPos]] = [data[newPos], data[i]];
            render();
        }
    }

    function downloadFile() {
        const content = "const tutorialData = " + JSON.stringify(data, null, 2) + ";";
        const blob = new Blob([content], {type: "text/javascript"});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "videos.js";
        link.click();
    }

    render();
</script>
</body>
</html>
