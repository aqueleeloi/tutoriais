<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>adminHUB | Portal de Acesso</title>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        
        posthog.init('phc_9xPN0iLCE7yTiZleow1k93LPp2GIPDubHR92KDhmMoD', { api_host: 'https://us.i.posthog.com' });
    </script>

    <style>
        body { background: #050505; color: white; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .hidden { display: none !important; }

        .container { display: flex; gap: 40px; align-items: stretch; }
        
        .card { 
            background: #111; border: 1px solid #222; padding: 40px; border-radius: 24px; 
            text-align: center; width: 320px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; justify-content: center;
        }

        .brand { font-size: 2rem; font-weight: 800; margin-bottom: 5px; letter-spacing: -1px; }
        .brand span { color: #00C6FF; }
        .divider { height: 1px; background: #333; margin: 25px 0; position: relative; }
        .divider span { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: #111; padding: 0 10px; color: #666; font-size: 0.8rem; }

        /* Estilo Input IEFP */
        .iefp-input {
            width: 100%; background: #1a1a1a; border: 1px solid #333; color: white;
            padding: 12px; border-radius: 8px; margin-bottom: 10px; outline: none;
            text-align: center;
        }
        .iefp-input:focus { border-color: #00C6FF; }
        
        .iefp-btn {
            width: 100%; background: #00C6FF; color: #000; border: none;
            padding: 12px; border-radius: 8px; font-weight: 800; cursor: pointer;
            transition: 0.2s;
        }
        .iefp-btn:hover { background: #fff; }

        /* Perfil */
        .user-img { width: 90px; height: 90px; border-radius: 50%; border: 3px solid #333; margin-bottom: 15px; }
        .badge { padding: 6px 12px; border-radius: 50px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; display: inline-block; margin-bottom: 20px; }
        .badge.admin { background: #00C6FF; color: #000; }
        .badge.user { background: #333; color: #888; border: 1px solid #555; }
        
        .btn-enter { width: 100%; padding: 16px; border-radius: 12px; border: none; cursor: pointer; font-weight: 700; margin-top: 10px; text-transform: uppercase; }
        .btn-enter.admin { background: linear-gradient(90deg, #00C6FF, #0072FF); color: white; }
        .btn-enter.user { background: #fff; color: #000; }

        @media (max-width: 700px) { .container { flex-direction: column; } }
    </style>
</head>
<body>

    <div id="login-view" class="container">
        
        <div class="card">
            <div class="brand">admin<span>HUB.</span></div>
            <p style="color:#666; font-size:0.85rem; margin-bottom: 20px;">Acesso Universal</p>
            
            <div id="googleBtn" style="display:flex; justify-content:center;"></div>
            
            <p style="font-size:0.7rem; color:#444; margin-top:20px;">
                Recomendado para contas Gmail
            </p>
        </div>

        <div class="card" style="border-color: #00C6FF;">
            <h3 style="margin-bottom: 5px;"><i class="fas fa-building"></i> Conta IEFP</h3>
            <p style="color:#666; font-size:0.85rem; margin-bottom: 20px;">Acesso Institucional</p>

            <input type="email" id="emailInput" class="iefp-input" placeholder="exemplo@formacao.iefp.pt">
            <button onclick="loginDireto()" class="iefp-btn">ENTRAR <i class="fas fa-arrow-right"></i></button>

            <p style="font-size:0.7rem; color:#444; margin-top:15px;">
                Acesso direto sem password Google
            </p>
        </div>

    </div>

    <div id="profile-view" class="card hidden" style="width: 380px;">
        <img id="p-img" class="user-img" src="">
        <h2 id="p-name" style="margin: 0; font-size: 1.4rem;"></h2>
        <div id="p-email" style="color: #666; font-size: 0.9rem; margin-bottom: 15px;"></div>
        <div id="p-badge" class="badge"></div>
        <div id="actions"></div>
        <div onclick="logout()" style="margin-top:20px; color:#666; cursor:pointer; font-size:0.8rem;">Sair</div>
    </div>

    <script>
        const GOOGLE_ID = "996132120935-0v98fg6n86hfjsk4p55qop3jld4sruos.apps.googleusercontent.com"; 
        
        // ======================================================
        // üö® CONFIGURA√á√ÉO DE SEGURAN√áA MANUAL
        // ======================================================
        const MEU_EMAIL_ADMIN = "for158342@formacao.iefp.pt"; 
        // ======================================================

        // --- 1. LOGIN VIA GOOGLE (Padr√£o) ---
        function handleGoogleLogin(response) {
            const data = jwtDecode(response.credential);
            processarLogin(data.name, data.email, data.picture);
        }

        // --- 2. LOGIN DIRETO IEFP (Bypass) ---
        function loginDireto() {
            const email = document.getElementById('emailInput').value.trim().toLowerCase();
            
            if (!email.endsWith("@formacao.iefp.pt")) {
                alert("‚ö†Ô∏è Por favor usa um email que termine em @formacao.iefp.pt");
                return;
            }

            // Simular dados do utilizador
            const nome = email.split('@')[0]; // Usa a parte antes do @ como nome
            const foto = "https://ui-avatars.com/api/?name=" + nome + "&background=00C6FF&color=fff";
            
            processarLogin(nome, email, foto);
        }

        // --- L√ìGICA CENTRAL ---
        function processarLogin(nome, email, foto) {
            // Verifica se √©s TU para dar Admin
            const isAdmin = (email === MEU_EMAIL_ADMIN);
            
            const userData = { name: nome, email: email, picture: foto };
            sessionStorage.setItem("hub_user", JSON.stringify(userData));
            sessionStorage.setItem("hub_role", isAdmin ? "admin" : "aluno");

            posthog.identify(email, { name: nome, email: email, role: isAdmin ? "formador" : "aluno" });

            // Mostrar Perfil
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('profile-view').classList.remove('hidden');
            
            document.getElementById('p-img').src = foto;
            document.getElementById('p-name').innerText = nome;
            document.getElementById('p-email').innerText = email;
            
            const badge = document.getElementById('p-badge');
            const actions = document.getElementById('actions');

            if(isAdmin) {
                badge.innerText = "ADMINISTRADOR (TU)";
                badge.className = "badge admin";
                actions.innerHTML = `<button class="btn-enter admin" onclick="entrar('admin.html')">Painel de Controlo</button>`;
            } else {
                badge.innerText = "ALUNO IEFP";
                badge.className = "badge user";
                actions.innerHTML = `<button class="btn-enter user" onclick="entrar('app.html')">Ver Conte√∫dos</button>`;
            }
        }

        function entrar(url) { window.location.href = url; }
        function logout() { sessionStorage.clear(); location.reload(); }

        window.onload = function() {
            google.accounts.id.initialize({ client_id: GOOGLE_ID, callback: handleGoogleLogin });
            google.accounts.id.renderButton(document.getElementById("googleBtn"), { theme: "outline", size: "large" });
        }

        function jwtDecode(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }
    </script>
</body>
</html>
